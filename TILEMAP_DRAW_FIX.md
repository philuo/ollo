# TileMap ç»˜åˆ¶åŠŸèƒ½ä¿®å¤è¯´æ˜

## âœ… å·²ä¿®å¤çš„é—®é¢˜

### 1. **ç“¦ç‰‡ç»˜åˆ¶åŠŸèƒ½ç°å·²å®Œå…¨å·¥ä½œ**

**é—®é¢˜**ï¼šé€‰ä¸­ç“¦ç‰‡åæ— æ³•åœ¨ç”»å¸ƒä¸Šç»˜åˆ¶

**ä¿®å¤**ï¼š
- âœ… å®Œå…¨é‡å†™äº†ç»˜åˆ¶é€»è¾‘
- âœ… æ·»åŠ äº†ç½‘æ ¼å åŠ å±‚ç”¨äºæ˜¾ç¤ºç½‘æ ¼çº¿
- âœ… å®ç°äº†æ— é™ç”»å¸ƒåŠŸèƒ½
- âœ… æ”¯æŒåˆå¹¶ç“¦ç‰‡çš„å®Œæ•´ç»˜åˆ¶

### 2. **æ— é™ç”»å¸ƒæ”¯æŒ**

**æ–°åŠŸèƒ½**ï¼š
- åœ°å›¾ä¼šæ ¹æ®ç»˜åˆ¶ä½ç½®è‡ªåŠ¨æ‰©å±•
- ä¸å†é™åˆ¶åœ¨åˆå§‹çš„ 50x50 å¤§å°
- è‡ªåŠ¨ç®¡ç†å›¾å±‚æ•°æ®æ‰©å±•

**ä½¿ç”¨æ–¹å¼**ï¼š
```
1. é€‰æ‹©ç“¦ç‰‡
2. åœ¨ç”»å¸ƒä»»æ„ä½ç½®ç‚¹å‡»
3. åœ°å›¾è‡ªåŠ¨æ‰©å±•ä»¥å®¹çº³æ–°ç“¦ç‰‡
```

### 3. **åˆå¹¶ç“¦ç‰‡å®Œæ•´ç»˜åˆ¶**

**é‡å¤§æ”¹è¿›**ï¼šä¹‹å‰åªç»˜åˆ¶åˆå¹¶ç»„çš„ç¬¬ä¸€ä¸ªç“¦ç‰‡ï¼Œç°åœ¨ç»˜åˆ¶æ•´ä¸ªç»„

**ç¤ºä¾‹**ï¼š
```
åˆå¹¶ 2x2 æ ‘æœ¨ç“¦ç‰‡ï¼š
ç´¢å¼•: [0, 1, 16, 17]

ç»˜åˆ¶æ—¶ï¼š
- ç‚¹å‡»ä¸€æ¬¡
- è‡ªåŠ¨ç»˜åˆ¶æ•´ä¸ª 2x2 åŒºåŸŸ
- æ‰€æœ‰ 4 ä¸ªç“¦ç‰‡éƒ½ä¼šè¢«æ”¾ç½®
```

### 4. **ç½‘æ ¼æ˜¾ç¤ºç³»ç»Ÿé‡æ„**

**æŠ€æœ¯æ”¹è¿›**ï¼š
- ä½¿ç”¨ç‹¬ç«‹çš„é€æ˜ 2D canvas å åŠ åœ¨ WebGPU canvas ä¸Š
- åªç»˜åˆ¶å¯è§åŒºåŸŸçš„ç½‘æ ¼çº¿ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
- å®æ—¶è·Ÿéšè§†å›¾å˜æ¢ï¼ˆå¹³ç§»ã€ç¼©æ”¾ï¼‰

**æ€§èƒ½æå‡**ï¼š
```
ä¹‹å‰ï¼šç»˜åˆ¶æ‰€æœ‰ç½‘æ ¼çº¿ï¼ˆå¯èƒ½æ•°åƒæ¡ï¼‰
ç°åœ¨ï¼šåªç»˜åˆ¶å±å¹•å¯è§çš„ç½‘æ ¼çº¿ï¼ˆé€šå¸¸ < 100 æ¡ï¼‰
```

## ğŸ® å®Œæ•´ä½¿ç”¨æµç¨‹

### ç»˜åˆ¶å•ä¸ªç“¦ç‰‡

```
1. ä¸Šä¼ ç“¦ç‰‡é›†
   â†“
2. è°ƒæ•´ç½‘æ ¼è®¾ç½®ï¼ˆå¦‚éœ€è¦ï¼‰
   â†“
3. åœ¨ç“¦ç‰‡é€‰æ‹©å™¨ä¸­ç‚¹å‡»ä¸€ä¸ªç“¦ç‰‡
   â†“
4. åœ¨ç”»å¸ƒä¸Šç‚¹å‡»æˆ–æ‹–åŠ¨é¼ æ ‡
   â†“
5. ç“¦ç‰‡è¢«ç»˜åˆ¶åˆ°åœ°å›¾ä¸Š âœ¨
```

### ç»˜åˆ¶åˆå¹¶ç“¦ç‰‡ç»„

```
1. ä¸Šä¼ ç“¦ç‰‡é›†
   â†“
2. æ¡†é€‰è¦åˆå¹¶çš„ç“¦ç‰‡ï¼ˆä¾‹å¦‚ 2x2ï¼‰
   â†“
3. æŒ‰ Cmd/Ctrl + G åˆå¹¶
   â†“
4. åœ¨ç”»å¸ƒä¸Šç‚¹å‡»ä¸€æ¬¡
   â†“
5. æ•´ä¸ª 2x2 ç»„è¢«ç»˜åˆ¶ âœ¨
```

### ä½¿ç”¨æ©¡çš®æ“¦

```
1. ç‚¹å‡»"æ©¡çš®æ“¦"å·¥å…·æŒ‰é’®
   â†“
2. åœ¨ç”»å¸ƒä¸Šç‚¹å‡»è¦åˆ é™¤çš„ç“¦ç‰‡
   â†“
3. ç“¦ç‰‡è¢«æ¸…é™¤ âœ¨
```

## ğŸ¨ è§†è§‰æ•ˆæœ

### ç½‘æ ¼æ˜¾ç¤º
- **é¢œè‰²**ï¼šåŠé€æ˜ç™½è‰² `rgba(255, 255, 255, 0.3)`
- **å¯è§æ€§**ï¼šé€šè¿‡å¤é€‰æ¡†æ§åˆ¶
- **å®æ—¶æ›´æ–°**ï¼šè·Ÿéšç¼©æ”¾å’Œå¹³ç§»

### ç”»å¸ƒäº¤äº’
- **ç¬”åˆ·æ¨¡å¼**ï¼šåå­—å…‰æ ‡
- **å¹³ç§»æ¨¡å¼**ï¼šæŠ“æ‰‹å…‰æ ‡
- **æ©¡çš®æ“¦æ¨¡å¼**ï¼šåå­—å…‰æ ‡

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### ç½‘æ ¼æ¸²æŸ“ä¼˜åŒ–
```typescript
// åªæ¸²æŸ“å¯è§åŒºåŸŸ
const startX = Math.max(0, Math.floor(-offsetX / tileWidth));
const endX = Math.min(data.width, Math.ceil((gridCanvasRef.width - offsetX) / tileWidth));

// åªç»˜åˆ¶è¿™ä¸ªèŒƒå›´å†…çš„ç½‘æ ¼çº¿
for (let x = startX; x <= endX; x++) {
  // ç»˜åˆ¶å‚ç›´çº¿
}
```

### åœ°å›¾æ‰©å±•ä¼˜åŒ–
```typescript
// åªåœ¨éœ€è¦æ—¶æ‰©å±•
if (targetX >= data.width || targetY >= data.height) {
  const newWidth = Math.max(data.width, targetX + 1);
  const newHeight = Math.max(data.height, targetY + 1);
  data = expandMap(data, newWidth, newHeight);
}
```

## ğŸ“‹ æŠ€æœ¯ç»†èŠ‚

### åŒå±‚ Canvas æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   äº¤äº’å±‚ (div)              â”‚  â† é¼ æ ‡äº‹ä»¶
â”‚   pointer-events: auto      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç½‘æ ¼å±‚ (2D canvas)        â”‚  â† ç½‘æ ¼çº¿
â”‚   pointer-events: none      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ¸²æŸ“å±‚ (WebGPU canvas)    â”‚  â† ç“¦ç‰‡
â”‚   position: absolute        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åæ ‡è½¬æ¢

```typescript
// å±å¹•åæ ‡ â†’ ç“¦ç‰‡åæ ‡
const tilePos = renderer.screenToTile(mouseX, mouseY);

// è€ƒè™‘è§†å›¾å˜æ¢
const offsetX = -vt.x * vt.zoom + canvas.width / 2;
const offsetY = -vt.y * vt.zoom + canvas.height / 2;
```

### åˆå¹¶ç“¦ç‰‡ç»˜åˆ¶é€»è¾‘

```typescript
// æ£€æŸ¥æ˜¯å¦æ˜¯åˆå¹¶ç“¦ç‰‡
for (const mt of metaTilesMap.values()) {
  if (mt.tiles.includes(selectedTile)) {
    // è®¡ç®—èµ·å§‹ä½ç½®
    const startCol = firstTileIndex % columns;
    const startRow = Math.floor(firstTileIndex / columns);
    
    // ç»˜åˆ¶æ•´ä¸ªç»„
    for (let dy = 0; dy < metaTile.height; dy++) {
      for (let dx = 0; dx < metaTile.width; dx++) {
        // ç»˜åˆ¶æ¯ä¸ªç“¦ç‰‡
      }
    }
  }
}
```

## âš¡ ç«‹å³ä½“éªŒ

```bash
npm run dev
```

è®¿é—®æµè§ˆå™¨ï¼Œè¿›å…¥ TileMap ç¼–è¾‘å™¨ï¼š

1. **ä¸Šä¼ æµ‹è¯•ç“¦ç‰‡é›†**
   - ä½¿ç”¨é¡¹ç›®ä¸­çš„ `/src/sprites/8-Tile-Sets/Tile-Sets (64-64).png`
   - æˆ–ä»»ä½•å…¶ä»–ç“¦ç‰‡é›†å›¾ç‰‡

2. **è°ƒæ•´ç½‘æ ¼**
   - é»˜è®¤è‡ªåŠ¨è¯†åˆ«
   - å¯æ‰‹åŠ¨è°ƒæ•´ä¸º 64x64

3. **å¼€å§‹ç»˜åˆ¶**
   - é€‰æ‹©å•ä¸ªç“¦ç‰‡å¹¶ç‚¹å‡»ç”»å¸ƒ
   - æˆ–æ¡†é€‰å¤šä¸ªç“¦ç‰‡ï¼Œåˆå¹¶åç»˜åˆ¶

4. **æµ‹è¯•åˆå¹¶åŠŸèƒ½**
   - é€‰æ‹© 2x2 åŒºåŸŸ
   - Cmd/Ctrl + G åˆå¹¶
   - ç‚¹å‡»ç”»å¸ƒï¼Œè§‚å¯Ÿæ•´ä¸ªç»„è¢«ç»˜åˆ¶

## ğŸ¯ ä½¿ç”¨æŠ€å·§

### å¿«é€Ÿå¡«å……
```
1. é€‰æ‹©è¦é‡å¤çš„ç“¦ç‰‡
2. æŒ‰ä½é¼ æ ‡å·¦é”®æ‹–åŠ¨
3. å¿«é€Ÿå¡«å……å¤§é¢ç§¯åŒºåŸŸ
```

### ç²¾ç¡®æ”¾ç½®
```
1. æ”¾å¤§è§†å›¾ï¼ˆæ»šè½®å‘ä¸Šï¼‰
2. ç²¾ç¡®ç‚¹å‡»ç›®æ ‡ä½ç½®
3. ç¼©å°æŸ¥çœ‹æ•´ä½“æ•ˆæœ
```

### å¤§å‹ç»“æ„
```
1. åˆå¹¶å»ºç­‘ç‰©çš„æ‰€æœ‰ç“¦ç‰‡ï¼ˆå¦‚ 3x4ï¼‰
2. ä¸€æ¬¡ç‚¹å‡»æ”¾ç½®æ•´ä¸ªå»ºç­‘
3. èŠ‚çœå¤§é‡æ—¶é—´
```

## â“ å¸¸è§é—®é¢˜

**Q: ç»˜åˆ¶æ—¶æ²¡æœ‰ååº”ï¼Ÿ**

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. æ˜¯å¦é€‰æ‹©äº†ç“¦ç‰‡ï¼ˆæŸ¥çœ‹å³ä¾§é¢æ¿ï¼‰
2. æ˜¯å¦é€‰æ‹©äº†"ç¬”åˆ·"å·¥å…·
3. æ˜¯å¦ä¸Šä¼ äº†ç“¦ç‰‡é›†
4. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯

**Q: ç½‘æ ¼çº¿çœ‹ä¸è§ï¼Ÿ**

A: 
1. ç¡®ä¿å‹¾é€‰äº†"æ˜¾ç¤ºç½‘æ ¼"å¤é€‰æ¡†
2. å°è¯•æ”¾å¤§è§†å›¾
3. æ£€æŸ¥ç½‘æ ¼çº¿é¢œè‰²æ˜¯å¦ä¸èƒŒæ™¯å¯¹æ¯”åº¦è¶³å¤Ÿ

**Q: åˆå¹¶ç“¦ç‰‡åªç»˜åˆ¶äº†ä¸€éƒ¨åˆ†ï¼Ÿ**

A: 
1. ç¡®ä¿é€‰æ‹©çš„æ˜¯çŸ©å½¢åŒºåŸŸ
2. é‡æ–°åˆå¹¶ç“¦ç‰‡
3. æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

**Q: åœ°å›¾å¤ªå¤§äº†æ€ä¹ˆåŠï¼Ÿ**

A: 
1. ä½¿ç”¨"è°ƒæ•´å¤§å°"åŠŸèƒ½ç¼©å°
2. æˆ–è€…å¯¼å‡ºåæ‰‹åŠ¨ç¼–è¾‘ JSON
3. ä¸‹æ¬¡åˆ›å»ºæ—¶æŒ‡å®šåˆé€‚çš„åˆå§‹å¤§å°

## ğŸ”„ æ›´æ–°æ—¥å¿—

### v1.2.0 (å½“å‰ç‰ˆæœ¬)

- âœ… ä¿®å¤ç“¦ç‰‡ç»˜åˆ¶åŠŸèƒ½
- âœ… å®ç°æ— é™ç”»å¸ƒ
- âœ… å®Œæ•´çš„åˆå¹¶ç“¦ç‰‡ç»˜åˆ¶
- âœ… ä¼˜åŒ–ç½‘æ ¼æ˜¾ç¤ºæ€§èƒ½
- âœ… åŒå±‚ Canvas æ¶æ„
- âœ… è‡ªåŠ¨åœ°å›¾æ‰©å±•

---

**ç°åœ¨ TileMap ç¼–è¾‘å™¨å®Œå…¨å¯ç”¨ï¼** ğŸ‰

å¼€å§‹åˆ›å»ºæ‚¨çš„æ¸¸æˆåœ°å›¾å§ï¼ğŸ—ºï¸âœ¨

